FROM shinsaku0523/zkevm:latest

ARG BENCH_CMD

COPY . .

RUN RUSTFLAGS='-C target-cpu=native' cargo bench --no-run --bench evm_prover &&\
    RUSTFLAGS='-C target-cpu=native' cargo test --no-run --profile bench bench_state_circuit_prover

CMD RUSTFLAGS='-C target-cpu=native' cargo $BENCH_CMD
